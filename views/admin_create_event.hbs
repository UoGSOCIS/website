


<div class="container">
<form id="event_form">
    <div class="form-group">
        <label for="event_title">Title</label>
        <input type="txt" class="form-control" id="event_title" placeholder="Enter title">
    </div>

    <div class="form-group">
        <label for="event_location">Location</label>
        <input type="txt" class="form-control" id="event_location" placeholder="Enter location">
    </div>

    <div class="form-group">
        <label for="event_tag">Tag</label>

        <select name="event_tag" form="event_form" class="form-control" id="event_tag">
            <option value="event" selected>Event</option>
            <option value="gcc">GCC</option>
        </select>
    </div>
    <div class="form-group">
        <label for="datepicker">Date</label>
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group">
                    <div class="input-group date" id="datetimepicker4" data-target-input="nearest">
                        <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker4" id="date_input"/>
                        <div class="input-group-append" data-target="#datetimepicker4" data-toggle="datetimepicker">
                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">
                <div class="form-group">
                    <div class="input-group date" id="datetimepicker3" data-target-input="nearest">
                        <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker3" id="start_time_input"/>
                        <div class="input-group-append" data-target="#datetimepicker3" data-toggle="datetimepicker">
                            <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-2">
                <div class="form-group">
                    <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                        <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker2" id="end_time_input"/>
                        <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                            <div class="input-group-text"><i class="fa fa-clock-o"></i></div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
    <div class="form-group">

        <div class="card bg-light mb-3">

            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" id="edit_btn" href="#">Edit </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="preview_btn" href="#">Preview</a>
                    </li>
                </ul>
            </div>

            <div class="card-body">
                <label for="text_area">Event Description: </label>

            <div id="text_area">
                <textarea class="form-control" rows="10" id="text_input"></textarea>
            </div>


            <div id="preview_area" style="display:none" >
            </div>
        </div>
    </div>
    <button type="button" class="btn btn-primary" onclick="uploadEvent()">Submit</button>
</form>

</div>


<script src="/js/moment.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>



<script>
    $('#preview_btn').on('click',function(){
        $("#text_area").hide();

        $("#edit_btn").removeClass("active");
        $("#preview_btn").addClass("active");


        $("#preview_area").html(marked($("#text_input").val()));
        $("#preview_area").show();
    });

    $('#edit_btn').on('click',function(){

        $("#edit_btn").addClass("active");
        $("#preview_btn").removeClass("active");

        $("#preview_area").hide();
        $("#text_area").show();
    });
</script>

<script type="text/javascript">
    $(function () {
        $('#datetimepicker4').datetimepicker({
            format: 'YYYY-MM-DD'
        });

        $('#datetimepicker3').datetimepicker({
            format: 'HH:mm'
        });

        $('#datetimepicker2').datetimepicker({
            format: 'HH:mm'
        });
    });
</script>

<script>
    function uploadEvent() {


        const title = document.getElementById("event_title").value.trim();
        const description = document.getElementById("text_input").value.trim();
        const location = document.getElementById("event_location").value.trim();
        const tag = document.getElementById("event_tag").value.trim();

        const date = document.getElementById("date_input").value.trim();
        const start_time = document.getElementById("start_time_input").value.trim();
        const end_time = document.getElementById("end_time_input").value.trim();


        const str = new Date().toString().match(/([-\+][0-9]+)\s/)[1];
        const timeZone = str.slice(0, 3) + ":" + str.slice(3);

        const startTime = date + "T" + start_time + ":00.000" + timeZone;
        const endTime = date + "T" + end_time + ":00.000"  + timeZone;



        // check to make sure that the at input has been set
        if (title === "") {
            alert("title must be set");
            return;
        }

        if (location === "") {
            alert("location must be set");
            return;
        }

        if (description === "") {
            alert("description must be set");
            return;
        }

        if (date === "") {
            alert("date must be set");
            return;
        }

        if (start_time === "") {
            alert("start_time must be set");
            return;
        }

        if (end_time === "") {
            alert("end_time must be set");
            return;
        }


        const event = {
            start_time:  startTime,
            end_time: endTime,
            title:  title,
            description:  description,
            location: location,
            tags: [tag]
        };


        // upload the event and the attachments here
        $.ajax({url: "/api/v1/events",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(event),
            complete: function(xhr, status){

                var responseCode = xhr.status;
                var response = JSON.parse(xhr.responseText);

                if (responseCode === 201) {
                    //uploadFilesForPost(response);
                    alert("event created successfully");
                    return;
                }

                alert("error! " + response.message);
            },
        });
    }
</script>